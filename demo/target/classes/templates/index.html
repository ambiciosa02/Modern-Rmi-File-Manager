<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern File Manager</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <!-- Mobile Sidebar Toggle -->
    <div class="sidebar-toggle" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay" style="display: none;">
        <div class="loading-spinner"></div>
        <p>Loading files...</p>
    </div>

    <!-- Main App Container -->
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-cloud"></i>
                    <span>File Manager</span>
                </div>
            </div>
            
            <!-- User Profile -->
            <div class="user-profile">
                <div class="user-avatar">
                    <i class="fas fa-user-circle"></i>
                </div>
                <div class="user-info">
                    <div class="user-name" id="sidebar-username">Loading...</div>
                    <div class="user-role" id="sidebar-userrole">Loading...</div>
                </div>
            </div>
            
            <nav class="sidebar-nav">
                <a href="#" class="nav-item active" onclick="handleNavItemClick(this); return false;">
                    <i class="fas fa-home"></i>
                    <span>Home</span>
                </a>
                <a href="#" class="nav-item" onclick="handleNavItemClick(this); return false;">
                    <i class="fas fa-folder"></i>
                    <span>My Files</span>
                </a>

                <a href="#" class="nav-item" onclick="handleNavItemClick(this); return false;">
                    <i class="fas fa-clock-rotate-left"></i>
                    <span>Recent</span>
                </a>
                <a href="#" class="nav-item" onclick="handleNavItemClick(this); return false;">
                    <i class="fas fa-share-alt"></i>
                    <span>Shared</span>
                </a>
                <a href="#" class="nav-item" onclick="handleNavItemClick(this); return false;">
                    <i class="fas fa-users-cog"></i>
                    <span>User Management</span>
                </a>
                <a href="#" class="nav-item" onclick="logoutUser(); return false;">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </a>
            </nav>
            
            <div class="storage-info">
                <div class="storage-label">
                    <span>Storage Usage</span>
                    <span id="storage-percentage"></span>
                </div>
                <div class="storage-bar">
                    <div class="storage-fill" id="storage-fill"></div>
                </div>
                <div style="margin-top: 8px; font-size: 12px; color: var(--text-muted);">
                    <span id="storage-used">0 B</span> used
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Top Bar -->
            <div class="top-bar glass">
                <div class="breadcrumb" id="breadcrumb">
                    <a href="#" onclick="navigateToFolder(''); return false;">Home</a>
                    <span class="separator">/</span>
                    <span>All Files</span>
                </div>
                
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="search-input" placeholder="Search files and folders..." 
                           oninput="searchFiles()">
                </div>
            </div>

            <!-- Toolbar -->
            <div class="toolbar">
                <div class="view-controls">
                    <button class="view-btn active" onclick="setViewMode('grid')">
                        <i class="fas fa-grid"></i>
                    </button>
                    <button class="view-btn" onclick="setViewMode('list')">
                        <i class="fas fa-list"></i>
                    </button>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-secondary" onclick="showNewFolderModal()">
                        <i class="fas fa-folder-plus"></i>
                        New Folder
                    </button>
                    <button class="btn btn-primary" onclick="triggerFileUpload()">
                        <i class="fas fa-upload"></i>
                        Upload Files
                    </button>
                    <button class="btn btn-secondary" onclick="downloadSelected()" id="download-btn" disabled>
                        <i class="fas fa-download"></i>
                        Download
                    </button>
                    <button class="btn btn-danger" onclick="deleteSelected()" id="delete-btn" disabled>
                        <i class="fas fa-trash"></i>
                        Delete
                    </button>
                </div>
            </div>

            <!-- File Area -->
            <div class="file-area" id="file-area">
                <!-- Error message will be displayed here if needed -->
                <div th:if="${error and !#strings.isEmpty(error)}" class="error-message">
                    <i class="fas fa-exclamation-circle"></i>
                    <span th:text="${error}"></span>
                </div>
                
                <div class="file-grid" id="file-container">
                    <!-- Files will be loaded here via JavaScript -->
                </div>
            </div>
        </div>

        <!-- Selection Info Bar -->
        <div class="selection-info" id="selection-info" style="display: none;">
            <span id="selected-count">0 files selected</span>
            <button class="btn btn-secondary" onclick="clearSelection()">
                <i class="fas fa-times"></i>
                Clear
            </button>
        </div>
    </div>

    <!-- File Upload Input (Hidden) -->
    <input type="file" id="file-input" multiple style="display: none;" onchange="handleFileSelect(this.files)">

    <!-- Context Menu -->
    <div class="context-menu glass" id="context-menu">
        <div class="context-menu-item" onclick="downloadSelected()">
            <i class="fas fa-download"></i>
            <span>Download</span>
        </div>
        <div class="context-menu-item" onclick="renameFile()">
            <i class="fas fa-edit"></i>
            <span>Rename</span>
        </div>
        <div class="context-menu-item" onclick="shareFile()">
            <i class="fas fa-share"></i>
            <span>Share</span>
        </div>
        <div class="context-divider"></div>
        <div class="context-menu-item" onclick="deleteSelected()">
            <i class="fas fa-trash"></i>
            <span>Delete</span>
        </div>
    </div>

    <!-- Drop Zone -->
    <div class="drop-zone" id="drop-zone">
        <div class="drop-content">
            <i class="fas fa-cloud-upload-alt"></i>
            <h2>Drop files to upload</h2>
            <p>Drag and drop files here to add them to your storage</p>
        </div>
    </div>

    <!-- Progress Overlay -->
    <div class="progress-overlay" id="progress-overlay">
        <div class="progress-content glass">
            <h3>Uploading Files</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            <p id="progress-text">0% â€¢ 0 of 0 files</p>
        </div>
    </div>

    <!-- New Folder Modal -->
    <div class="modal" id="new-folder-modal">
        <div class="modal-content glass">
            <div class="modal-header">
                <h3 class="modal-title">Create New Folder</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" for="folder-name">Folder Name</label>
                    <input type="text" id="folder-name" class="form-input" placeholder="Enter folder name" autofocus>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('new-folder-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="createNewFolder()">Create</button>
            </div>
        </div>
    </div>

    <!-- Rename Modal -->
    <div class="modal" id="rename-modal">
        <div class="modal-content glass">
            <div class="modal-header">
                <h3 class="modal-title">Rename File</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" for="rename-input">New Name</label>
                    <input type="text" id="rename-input" class="form-input" placeholder="Enter new name">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('rename-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="confirmRename()">Rename</button>
            </div>
        </div>
    </div>

    <!-- Share Modal -->
    <div class="modal" id="share-modal">
        <div class="modal-content glass">
            <div class="modal-header">
                <h3 class="modal-title">Share File</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" for="share-link">Shareable Link</label>
                    <input type="text" id="share-link" class="form-input" readonly 
                           value="https://filemanager.com/share/abc123">
                </div>
                <div class="form-group">
                    <label class="form-label">Permissions</label>
                    <select id="share-permissions" class="form-input">
                        <option value="view">Can View</option>
                        <option value="edit">Can Edit</option>
                        <option value="download">Can Download</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('share-modal')">Close</button>
                <button class="btn btn-primary" onclick="copyShareLink()">
                    <i class="fas fa-copy"></i>
                    Copy Link
                </button>
            </div>
        </div>
    </div>

    <!-- User Management Modal -->
    <div class="modal" id="user-management-modal">
        <div class="modal-content glass">
            <div class="modal-header">
                <h3 class="modal-title">User Management</h3>
            </div>
            <div class="modal-body">
                <div class="current-user-info">
                    <h4>Current User</h4>
                    <p><strong>Username:</strong> <span id="current-username"></span></p>
                    <p><strong>Email:</strong> <span id="current-email"></span></p>
                    <p><strong>Role:</strong> <span id="current-role"></span></p>
                    <p><strong>Account Created:</strong> <span id="account-created"></span></p>
                </div>
                
                <div class="users-list-container">
                    <h4>All Users</h4>
                    <div id="users-list" class="users-list"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="showCreateUserModal()">
                    <i class="fas fa-user-plus"></i> Create New User
                </button>
                <button class="btn btn-secondary" onclick="hideModal('user-management-modal')">Close</button>
            </div>
        </div>
    </div>

    <!-- Create User Modal -->
    <div class="modal" id="create-user-modal">
        <div class="modal-content glass">
            <div class="modal-header">
                <h3 class="modal-title">Create New User</h3>
            </div>
            <div class="modal-body">
                <form id="new-user-form">
                    <div class="form-group">
                        <label class="form-label">Full Name</label>
                        <input type="text" id="new-user-name" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Username</label>
                        <input type="text" id="new-user-username" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" id="new-user-email" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" id="new-user-password" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Role</label>
                        <select id="new-user-role" class="form-input">
                            <option value="user">Regular User</option>
                            <option value="admin">Administrator</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('create-user-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="createNewUserFromForm()">Create User</button>
            </div>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div class="modal" id="change-password-modal">
        <div class="modal-content glass">
            <div class="modal-header">
                <h3 class="modal-title">Change Password</h3>
            </div>
            <div class="modal-body">
                <form id="change-password-form">
                    <div class="form-group">
                        <label class="form-label">Current Password</label>
                        <input type="password" id="current-password" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">New Password</label>
                        <input type="password" id="new-password" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Confirm New Password</label>
                        <input type="password" id="confirm-password" class="form-input" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('change-password-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="changePasswordFromForm()">Change Password</button>
            </div>
        </div>
    </div>


    <!-- Toast Container -->
    <div id="toast-container"></div>

    <script src="/js/app.js"></script>
</body>
</html>